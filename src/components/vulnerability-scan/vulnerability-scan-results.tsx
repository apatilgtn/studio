
"use client";

import type { SecurityVulnerabilityScanOutput } from "@/ai/flows/security-vulnerability-scan";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Icons } from "@/components/icons";
import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Badge } from "@/components/ui/badge";

interface VulnerabilityScanResultsProps {
  results: SecurityVulnerabilityScanOutput | null;
  isLoading: boolean;
  error: string | null;
}

export function VulnerabilityScanResults({ results, isLoading, error }: VulnerabilityScanResultsProps) {
  if (isLoading) {
    return (
      <Card className="mt-4 md:mt-6 shadow-lg"> {/* Reduced margin */}
        <CardHeader>
          <CardTitle className="text-lg md:text-xl flex items-center gap-2"> {/* Reduced size */}
            <Icons.Loader className="w-4 h-4 md:w-5 md:h-5 animate-spin text-primary" /> Scanning for Vulnerabilities...
          </CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-xs md:text-sm text-muted-foreground">The AI is analyzing the OpenAPI specification. This may take a moment.</p>
        </CardContent>
      </Card>
    );
  }

  if (error) {
    return (
      <Alert variant="destructive" className="mt-4 md:mt-6"> {/* Reduced margin */}
        <Icons.AlertTriangle className="h-4 w-4" />
        <AlertTitle className="text-sm md:text-base">Scan Error</AlertTitle> {/* Reduced size */}
        <AlertDescription className="text-xs md:text-sm">{error}</AlertDescription>
      </Alert>
    );
  }

  if (!results) {
    return null; 
  }

  const { vulnerabilities, recommendations } = results;

  return (
    <Card className="mt-4 md:mt-6 shadow-xl"> {/* Reduced margin */}
      <CardHeader className="bg-primary/5">
        <CardTitle className="text-xl md:text-2xl flex items-center gap-2"> {/* Reduced size */}
          <Icons.ShieldAlert className="w-6 h-6 md:w-7 md:h-7 text-primary" /> Security Scan Report
        </CardTitle>
        <CardDescription className="text-xs md:text-sm">
          AI-powered analysis of potential security vulnerabilities and recommendations.
        </CardDescription>
      </CardHeader>
      <CardContent className="pt-4 md:pt-6 grid md:grid-cols-2 gap-4 md:gap-6"> {/* Reduced padding/gap */}
        <div>
          <h3 className="text-base md:text-lg font-semibold mb-2 flex items-center gap-2"> {/* Reduced size/margin */}
            <Icons.AlertTriangle className="w-4 h-4 md:w-5 md:h-5 text-destructive" /> Identified Vulnerabilities
            <Badge variant="destructive" className="ml-auto text-xs">{vulnerabilities.length}</Badge>
          </h3>
          {vulnerabilities.length > 0 ? (
            <ScrollArea className="h-60 md:h-72 rounded-md border p-3 bg-muted/30"> {/* Reduced padding */}
              <ul className="space-y-2"> {/* Reduced spacing */}
                {vulnerabilities.map((vuln, index) => (
                  <li key={index} className="text-xs md:text-sm p-2 bg-background rounded-md shadow-sm border border-destructive/50"> {/* Reduced padding/text */}
                    <p className="font-medium text-destructive-foreground bg-destructive px-2 py-0.5 rounded-t-md -mx-2 -mt-2 mb-1.5 text-xs">Vulnerability #{index+1}</p> {/* Reduced padding/margin/text */}
                    {vuln}
                  </li>
                ))}
              </ul>
            </ScrollArea>
          ) : (
            <Alert>
              <Icons.CheckCircle2 className="h-4 w-4" />
              <AlertTitle className="text-sm md:text-base">No Vulnerabilities Found</AlertTitle> {/* Reduced size */}
              <AlertDescription className="text-xs md:text-sm">The AI scan did not identify any specific vulnerabilities.</AlertDescription>
            </Alert>
          )}
        </div>
        <div>
          <h3 className="text-base md:text-lg font-semibold mb-2 flex items-center gap-2"> {/* Reduced size/margin */}
            <Icons.Settings className="w-4 h-4 md:w-5 md:h-5 text-green-600" /> Recommendations
            <Badge variant="default" className="ml-auto bg-green-600 hover:bg-green-700 text-white text-xs">{recommendations.length}</Badge>
          </h3>
          {recommendations.length > 0 ? (
            <ScrollArea className="h-60 md:h-72 rounded-md border p-3 bg-muted/30"> {/* Reduced padding */}
              <ul className="space-y-2"> {/* Reduced spacing */}
                {recommendations.map((rec, index) => (
                  <li key={index} className="text-xs md:text-sm p-2 bg-background rounded-md shadow-sm border border-green-500/50"> {/* Reduced padding/text */}
                     <p className="font-medium text-white bg-green-600 px-2 py-0.5 rounded-t-md -mx-2 -mt-2 mb-1.5 text-xs">Recommendation #{index+1}</p> {/* Reduced padding/margin/text */}
                    {rec}
                  </li>
                ))}
              </ul>
            </ScrollArea>
          ) : (
            <Alert>
              <Icons.Info className="h-4 w-4" />
              <AlertTitle className="text-sm md:text-base">No Specific Recommendations</AlertTitle> {/* Reduced size */}
              <AlertDescription className="text-xs md:text-sm">The AI scan did not provide specific recommendations.</AlertDescription>
            </Alert>
          )}
        </div>
      </CardContent>
    </Card>
  );
}
